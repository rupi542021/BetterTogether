<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>

    <link href="MyStyleSheet.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>




    <script>

        $(document).ready(function () {

            ajaxCall("GET", "../api/students/getpercentregistered", "", getpercentregistered, error);


        })

        function getpercentregistered(StuRatio) {
            console.log(StuRatio);
            Ratio = (StuRatio[0] / StuRatio[1]) * 100;
            Ratio = Math.round((Ratio + Number.EPSILON) * 100) / 100;

            $("#ratioStu").append("<b>" + Ratio + "%" + "</b></br>" + "סטודנטים רשומים לאפליקציה");
            $("#quantitystu").append("<b>" + StuRatio[0] + "</b></br>" + " סטודנטים רשומים לאפליקציה ");

            ajaxCall("GET", "../api/Questionnaire/getpercentActiveQr", "", getpercentActiveQr, error);
        }

        function getpercentActiveQr(Qrratio) {
            console.log(Qrratio);
            Ratio = (Qrratio[0] / Qrratio[1]) * 100;
            Ratio = Math.round((Ratio + Number.EPSILON) * 100) / 100;

            $("#ratioQr").append("<b>" + Ratio + "%" + "</b></br>" + "שאלונים פעילים");
            $("#quantityQr").append("<b>" + Qrratio[1] + "</b></br>" + "כמות השאלונים שפורסמו עד כה");
            ajaxCall("GET", "../api/students/getpercentregiByDep", "", getpercentregiByDep, error);

        }

        function getpercentregiByDep(StuByDep) {
            console.log(StuByDep);
            StudentByDep = StuByDep;
            AllStudents = [];
            RegisteredOnly = []

            for (var i = 0; i < StudentByDep.length; i++) {
                for (var j = 0; j < StudentByDep[i].length; j++) {
                    if (StudentByDep[i] == StudentByDep[0])
                        AllStudents.push(StudentByDep[i][j])
                    else
                        RegisteredOnly.push(StudentByDep[i][j])
                }
            }
            console.log(AllStudents);
            console.log(RegisteredOnly)
            var barChartData = {
                labels: [
                    "הנדסת חשמל",
                    "הנדסת מחשבים",
                    "הנדסת תעשייה וניהול",
                    "מדעי המחשב והמידע",
                    "כלכלה ומנהל",
                    "כלכלה וחשבונאות",
                    "מנהל עסקים",
                    "פסיכולוגיה",
                    "עבודה סוציאלית",
                    "סיעוד"
                ],
                datasets: [
                    {
                        label: "רשומים לאפליקציה",
                        backgroundColor: "#F5E686",
                        borderColor: "black",
                        borderWidth: 1,
                        data: RegisteredOnly
                    },
                    {
                        label: "לומדים ברופין",
                        backgroundColor: "#8b939b",
                        borderColor: "black",
                        borderWidth: 1,
                        data: AllStudents
                     },

                ]
            };

            var chartOptions = {
                responsive: true,
                legend: {
                    position: "top"
                },
                title: {
                    display: true,
                    text: "סטודנטים הרשומים לאפליקציה מסך הסטודנטים לפי מחלקות"
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
             

            var ctx = document.getElementById('canvasdep').getContext('2d');
            new Chart(ctx, {
                type: "bar",
                data: barChartData,
                options: chartOptions
            });


            ajaxCall("GET", "../api/students/getpercentregiByYear", "", getpercentregiByYear, error);


        }

        function getpercentregiByYear(StuByYear) {
            console.log(StuByYear);
            AllStudents = [];
            RegisteredOnly = []

            for (var i = 0; i < StuByYear.length; i++) {
                for (var j = 0; j < StuByYear[i].length; j++) {
                    if (StuByYear[i] == StuByYear[0])
                        AllStudents.push(StuByYear[i][j])
                    else
                        RegisteredOnly.push(StuByYear[i][j])
                }
            }
            console.log(AllStudents);
            console.log(RegisteredOnly)
            var barChartData = {
                labels: [
                    "א",
                    "ב",
                    "ג",
                    "ד",              
                ],
                datasets: [
                    {
                        label: "רשומים לאפליקציה",
                        backgroundColor: "#F5E686",
                        borderColor: "black",
                        borderWidth: 1,
                        data: RegisteredOnly
                    },
                    {
                        label: "לומדים ברופין",
                        backgroundColor: "#8b939b",
                        borderColor: "black",
                        borderWidth: 1,
                        data: AllStudents
                    },

                ]
            };

            var chartOptions = {
                responsive: true,
                legend: {
                    position: "top"
                },
                title: {
                    display: true,
                    text: "סטודנטים הרשומים לאפליקציה מסך הסטודנטים לפי שנה"
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }


            var ctx = document.getElementById('canvasyear').getContext('2d');
            new Chart(ctx, {
                type: "bar",
                data: barChartData,
                options: chartOptions
            });

            ajaxCall("GET", "../api/students/getnumOfEntries", "", getnumOfEntries, error);


        }


        function getnumOfEntries(numOfEntries) {
            console.log(numOfEntries)
            $("#entrynum").append("<b>" + numOfEntries + "</b></br>" + "כניסות לאפליקציה עד כה");

            ajaxCall("GET", "../api/Questionnaire/getAnsList", "", getAnsList, error);


        }

        function getAnsList(AnsList) {
            console.log(AnsList);
            ansList = AnsList;
            ajaxCall("GET", "../api/students/getstudentsAns", "", getstudentsans, error);

        }

        function getstudentsans(studentsAns) {
            console.log(studentsAns);
            StudentsAns = studentsAns;
            arrAns = [0, 0, 0, 0, 0, 0];
            for (var i = 0; i < StudentsAns.length; i++) {
                for (var j = 0; j < StudentsAns[i].StudAns.length; j++) {
                    if (StudentsAns[i].StudAns[j] == true) {
                            arrAns[j]++;
                        
                    }
                }
            }
            console.log(arrAns)
        }

        function error(err) {
            console.log(err)
        }

    </script>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <ul class="nav navbar-nav">
                <li class="active"><a href="Home.html">דף הבית</a></li>
                <li><a href="AdsTB.html">פרסומים</a></li>
                <li><a href="EventTB.html">אירועים</a></li>
                <li><a href="Questionnaire.html">שאלונים</a></li>
                <li id="titleNav"><a id="navT">היחידת ליזמות חברתית</a></li>
            </ul>
        </div>
    </nav>
    <div class="row">
        <div class="flip-card col-sm-3 ">
            <div class="flip-card-inner">
                <div class="flip-card-front">
                    <h2 id="ratioStu"></h2>
                </div>
                <div class="flip-card-back">
                    <h2 id="quantitystu"></h2>
                </div>
            </div>
        </div>

        <div class="flip-card col-sm-3">
            <div class="flip-card-inner">
                <div class="flip-card-front">
                    <h2 id="ratioQr"></h2>
                </div>
                <div class="flip-card-back">
                    <h2 id="quantityQr"></h2>

                </div>
            </div>
        </div>


        <div class="flip-card col-sm-3">
            <div class="flip-card-inner">
                <div class="flip-card-front">
                    <h2 id="entrynum"></h2>
                </div>
                <div class="flip-card-back">
                    <h2 id="quantityDep"></h2>

                </div>
            </div>
        </div>

        <div class="flip-card col-sm-3">
            <div class="flip-card-inner">
                <div class="flip-card-front">
                    <h2 id="ratioYear"></h2>
                </div>
                <div class="flip-card-back">
                    <h2 id="quantityYear"></h2>

                </div>
            </div>
        </div>
    </div>
    <div class="row" id="container">
        <div class="col-sm-6">
            <canvas id="canvasdep"></canvas>
        </div>
        <div class="col-sm-6">
            <canvas id="canvasyear"></canvas>
        </div>
    </div>
</body>
</html>