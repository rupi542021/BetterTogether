<!DOCTYPE html>
<html>
<head>


    <meta charset="utf-8" />
    <title></title>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <link href="MyStyleSheet.css" rel="stylesheet" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>




    <script>


        $(document).ready(function () {

            ajaxCall("GET", "../api/Events/geteventdetail", "", getSuccessAlleventdetail, error);
            google.charts.load('current', { 'packages': ['corechart'] });
            $(document).on("click", ".view", addpiechart);

        });

        function getSuccessAlleventdetail(eventdetail) {
            console.log(eventdetail);
            data = eventdetail;

            try {
                tbl = $('#detaileventtable').DataTable({
                    "oLanguage": {
                        "sLengthMenu": "הצגת _MENU_ אירועים", "sSearch": "חיפוש: "
                    },
                    data: eventdetail,
                    pageLength: 5,
                    columns: [

                        { data: "Eventtype" },
                        { data: "Eventname" },
                        {
                            data: "EventDate",
                            render: function (data, type, row, meta) {
                                shortDateEnd = new Date(data);
                                var dd = String(shortDateEnd.getDate()).padStart(2, '0');
                                var mm = String(shortDateEnd.getMonth() + 1).padStart(2, '0'); //ינואר זה חודש 0
                                var yyyy = shortDateEnd.getFullYear();

                                shortDateEnd = dd + '-' + mm + '-' + yyyy;
                                return shortDateEnd;
                            }
                        },
                        {
                            data: "Participant",
                            render: function (data, type, row, meta) {
                                return row.Studentsinevent.length;
                            }
                        },
                        

                        {
                            render: function (data, type, row, meta) {
                                ViewBtn = "<button class='view' evcode='" + row.EventCode + "' name='" + row.Eventname + "'par=" + row.Studentsinevent.length+" >צפי באישורי הגעה </button>";
                                return ViewBtn;
                            }
                        }
                    ],

                });

            }

            catch (err) {
                alert(err);
            }

        }

        function addpiechart() {
            participant = $(this).attr("par");
            eventName = $(this).attr("name");
            evcode = $(this).attr("evcode");
            countdep1 =0
            countdep2 =0
            countdep3 =0
            countdep4 =0
            countdep5 =0
            countdep6 =0
            countdep7 =0
            countdep8 =0
            countdep9 =0
            countdep10 =0 
            for (var i = 0; i < data.length; i++) {
                if (data[i].EventCode == evcode) {
                    for (var j = 0; j < data[i].Studentsinevent.length; j++) {
                        {
                            switch (data[i].Studentsinevent[j].Dep.DepartmentCode) {
                                case 1:
                                    countdep1++;
                                    break;
                                case 2:
                                    countdep2++;
                                    break;
                                case 3:
                                    countdep3++;
                                    break;
                                case 4:
                                    countdep4++;
                                    break;
                                case 5:
                                    countdep5++;
                                    break;
                                case 6:
                                    countdep6++;
                                    break;
                                case 7:
                                    countdep7++;
                                    break;
                                case 8:
                                    countdep8++;
                                    break;
                                case 9:
                                    countdep9++;
                                    break;
                                case 10:
                                    countdep10++;
                                    break;


                            }
                        }
                    }
                }
            }
                
                
            google.charts.setOnLoadCallback(drawChart);

        }


        function drawChart() {

            var data = google.visualization.arrayToDataTable([
                ['מחלקה', 'משתתפים באירוע'],
                ['הנדסת חשמל', countdep1 ],
                ['הנדסת מחשבים', countdep2],
                ['הנדסת תעשייה וניהול', countdep3],
                ['מדעי המחשב והמידע', countdep4],
                ['כלכלה ומנהל', countdep5],
                ['כלכלה וחשבונאות', countdep6],
                ['מנהל עסקים', countdep7],
                ['פסיכולוגיה', countdep8],
                ['עבודה סוציאלית', countdep9],
                ['סיעוד', countdep10],

            ]);
            if (participant != 0) {
                var options = {
                    title: 'השתתפות באירוע: ' + eventName,
                    is3D: true,
                    height: 400,
                    width: 600,


                    backgroundColor: 'transparent',
                    pieSliceTextStyle: {
                        color: '#3D3D3D',
                        bold: true,
                        fontSize: 20,
                    },

                    titleTextStyle: {
                        color: '#3D3D3D',
                        bold: true,
                        fontSize: 20,
                    },

                    slices: {
                        0: { color: '#FEFFAE' },
                        1: { color: '#96a2aa' }
                    }
                }
            }
            else if (participant == 0) {
                swal({icon:"warning", text: "! טרם אישרו הגעה לאירוע זה" })
                var options = {
                    backgroundColor: 'transparent',
                }
            }

            var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
            chart.draw(data, options);
        }



        function error(err) {
            console.log(err);
        }


    </script>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <ul class="nav navbar-nav">
                <li><a href="Ads.html">פרסומים</a></li>
                <li><a href="Events.html">ארועים חברתיים</a></li>
                <li><a href="AdsFeedBack.html">פידבק לפרסומים</a></li>
                <li><a href="EventsFeedBack.html">פידבק לארועים חברתיים</a></li>
                <li class="active"><a href="EventTB.html">משתתפים באירוע</a></li>
                <li><a href="Questionnaire.html">שאלונים</a></li>
                <li id="titleNav"><a id="navT">היחידת ליזמות חברתית</a></li>
            </ul>
        </div>
    </nav>
    <h2>משתתפים בארועים חברתיים</h2>
    <table id="detaileventtable" class="display nowrap" style="width:100%">
        <thead>
            <tr>
                <th> סוג אירוע</th>
                <th>שם אירוע</th>
                <th>תאריך אירוע</th>
                <th>מאשרי הגעה</th>
                <th></th>
            </tr>
        </thead>
    </table>


    <div id="piechart_3d" ></div>
</body>
</html>